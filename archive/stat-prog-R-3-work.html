<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>pendigits data - diret clustering</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="libs/highlightjs-1.1/highlight.js"></script>
<!--
    Font Awesome
-->
<script src="https://use.fontawesome.com/32d8325004.js"></script>
<link rel="stylesheet" href="libs/font-awesome-4.7.0/css/font-awesome.min.css">

<!--
    CSS perso
-->
<style>
    .contenu {
        margin-bottom: 50px;
    }

    .contact-liens {
        text-align: center;
    }
    .contact-liens:hover {
        text-decoration: none;
    }
    .contact-icones {
        height: 30px;
    }

    /* Espacement pour barre du haut et pied de page */
    #header, .section.level1 {
        margin-top: 60px;
        margin-bottom: 60px;
    }
    /* Espacement pour table des matières */
    #TOC {
        margin-top: 100px;
    }
    
    .footer {
        position: fixed;
        width: 100%;
        text-align: center;
        bottom: 0;
        left: 0;
        background-color: #E6E6E6;
    }
</style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs/bootstrap-journal.min.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->





<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">FX Jollois</a>
    </div>
    <div id="navbar-main" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">Données <span class="caret"></span></a>
          <ul class="dropdown-menu">
              <li><a href="accesdonnees.html">A télécharger</a></li>
              <li><a href="donnees-integrees-r.html">Sous R</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">Enseignement <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">DUT 1ère année</li>
            <li><a href="exploitation-donnees.html">Exploitation de données</a></li>
            <li><a href="initiation-a-r.html">Initiation à R</a></li>
            <li><a href="reporting.html">Reporting</a></li>
            <li><a href="complements-r.html">Compléments sur R</a></li>
            <li class="dropdown-header">DUT 2ème année</li>
            <li><a href="prog-stat-r.html">Programmation statistique avec R</a></li>
            <li class="dropdown-header">LP MDS Santé</li>
            <li><a href="info-dec-sante.html">Informatique décisionnelle</a></li>
            <li class="dropdown-header">DU Analyste Big Data</li>
            <li><a href="initiation-r-du.html">Initiation à R</a></li>
            <li><a href="connexion-r-mongodb.html">Connexion entre R et MongoDB</a></li>
            <li class="dropdown-header">DU Dataviz</li>
            <li><a href="analyse-donnees.html">Analyse de données</a></li>
            <li><a href="visualisation-donnees.html">Visualisation de données - R</a></li>
            <li><a href="visualisation-donnees-tableau.html">Visualisation de données - Tableau</a></li>
            <li><a href="visualisation-donnees-d3.html">Visualisation de données - D3</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Master</li>
            <li><a href="slides/cnam-classif-modeles.html">Classification et Modèles de mélange</a></li>
            <li><a href="analyse-donnees-massives.html">Analyse de Données Massives</a></li>
            <li class="dropdown-header">Iran</li>
            <li><a href="stat-prog-R.html">Statistical Programming using R</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">Recherche <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="recherche.html">Sujets</a></li>
            <li><a href="publications.html">Publications</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">Réalisations <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="realisations.html">Détail</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="http://up5.fr/explore-data" target="_blank">explore-data</a></li>
            <li><a href="http://fxjollois.github.io/cours-sql/" target="_blank">Appli web de cours pour SQL</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container-fluid -->
</div>
<div class="contenu">

<div class="fluid-row" id="header">



<h1 class="title toc-ignore"><code>pendigits</code> data - diret clustering</h1>
<h3 class="subtitle"><em>Statistical Programming using <code>R</code></em></h3>

</div>


<p>Here are the packages we use in this work.</p>
<pre class="r"><code>library(reshape2)
library(ggplot2)
library(FactoMineR)
library(NbClust)</code></pre>
<p>Here is the previous code (see <a href="stat-prog-R-1-work.html">here</a> for details) that we need in this part.</p>
<pre class="r"><code># Importation
pen.tra = read.table(&quot;donnees/pendigits.tra&quot;, sep = &quot;,&quot;)
pen.tes = read.table(&quot;donnees/pendigits.tes&quot;, sep = &quot;,&quot;)
pen = rbind(pen.tra, pen.tes)
names(pen) = c(paste0(c(&quot;X&quot;, &quot;Y&quot;), rep(1:8, each = 2)), &quot;digit&quot;)
pen$digit = factor(pen$digit)

# Drawn function
drawn &lt;- function(v, n = NULL, point = FALSE, add = FALSE, color = &quot;black&quot;) {
    # Transformation of the data.frame if needed
    if (is.data.frame(v))
        v = unlist(v)
    # extract x and y coordinates
    x = v[seq(1, 15, by = 2)]
    y = v[seq(2, 16, by = 2)]
    # optimize space into graphics in reducing margin (sse ?par for more information)
    opar = par(mar = c(0, 0, 2, 0) + .1)
    if (!add) { # Create a graphic
        plot(x, y, 
             # Specify limits is a way to have always the same frame for plotting lines
             xlim = c(-5, 105), ylim = c(-5, 105),
             # Do not show axes
             axes = FALSE,
             # If point is TRUE, we add a space (with pch = &quot; &quot;) at each point
             # If not, draw a line
             type = ifelse(point, &quot;b&quot;, &quot;l&quot;), 
             pch = &quot; &quot;, 
             # Specify color (black by default)
             col = color,
             # Add a title (NULL by default)
             main = n)
        if (point) text(x, y, 1:8)
    } else { # Add line to the plot
        # lines() add lines to an existing plot (the last produce)
        lines(x, y, 
              # same comment than before
              xlim = c(-5, 105), ylim = c(-5, 105),
              type = ifelse(point, &quot;b&quot;, &quot;l&quot;), 
              pch = &quot; &quot;, 
              col = color)
    }
    par(opar)
}

# PCA
res = PCA(pen, quali.sup = 17, graph = FALSE)
res2 = data.frame(res$ind$coord, digit = pen$digit)</code></pre>
<div id="application-on-pendigits" class="section level2">
<h2>Application on <code>pendigits</code></h2>
<div id="digit" class="section level3">
<h3><code>5</code> digit</h3>
<p>In our case, we have to perform a direct clustering for each digit. Here, we focus on the <code>5</code> digit. First, we compute <span class="math inline">\(k\)</span>-means with 2 clusters, as we notice from the PCA.</p>
<pre class="r"><code>km5 = kmeans(subset(pen, digit == 5, -digit), 2)
plot(Dim.2 ~ Dim.1, subset(res2, digit == 5, -digit), 
     col = rainbow(2)[km5$cluster], pch = 19)</code></pre>
<p><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We now use the <code>NbClust()</code> function to test all criteria, in order to get a good number of clusters.</p>
<pre class="r"><code>dig = 5
km5.nbcl = NbClust(subset(pen, digit == dig, -digit), method = &quot;kmeans&quot;, 
                   index = &quot;hartigan&quot;) # for all indices, use &quot;all&quot;</code></pre>
<p>We can now use the result of the automatic choice made by <code>NbClust()</code> to represent this 4 clusters. We do not use <code>ggplot()</code> to plot the factorial map, to be able to have in one graphic the mean digit for the clusters, and the projections for the points.</p>
<pre class="r"><code>km5.sub = data.frame(subset(pen, digit == dig, -digit),
                     cluster = factor(km5.nbcl$Best.partition))
km5.pca = data.frame(subset(res2, digit == dig, -digit),
                     cluster = factor(km5.nbcl$Best.partition))
km5.mean = aggregate(. ~ cluster, km5.sub, mean)
par(mfcol = c(2, km5.nbcl$Best.nc[1]), mar = c(0, 0, 0, 0) + .1)
for (k in 1:km5.nbcl$Best.nc[1]) {
    drawn(km5.mean[k,-1], point = TRUE)
    plot(Dim.2 ~ Dim.1, subset(km5.pca, cluster == k),
         xlim = range(res2$Dim.1),
         ylim = range(res2$Dim.2),
         col = rainbow(km5.nbcl$Best.nc[1])[k], pch = 19, 
         axes = FALSE, xlab = &quot;&quot;, ylab = &quot;&quot;, frame.plot = TRUE)
}</code></pre>
<p><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="for-all-digits" class="section level3">
<h3>For all digits</h3>
<p>We can apply the preceeding code to all digit, to get an estimation of the number of clusters for all of them. We transform it to directly get the part of the results we want.</p>
<pre class="r"><code>km.nbcl = lapply(0:9, function(dig) {
    sub = subset(pen, digit == dig, -digit)
    nbcl = NbClust(sub, 
                   method = &quot;kmeans&quot;, index = &quot;hartigan&quot;)
    sub$cluster = factor(nbcl$Best.partition)
    res = list(nc = nbcl$Best.nc[1],
               partition = nbcl$Best.partition,
               sub = sub,
               pca = data.frame(subset(res2, digit == dig, -digit),
                                cluster = factor(nbcl$Best.partition)),
               mean = aggregate(. ~ cluster, sub, mean))
})</code></pre>
<p>Now, we can represent all this results.</p>
<pre class="r"><code>for (dig in 0:9) {
    par(mfcol = c(2, km.nbcl[[dig+1]]$nc), mar = c(0, 0, 0, 0) + .1)
    for (k in 1:km.nbcl[[dig+1]]$nc) {
        drawn(km.nbcl[[dig+1]]$mean[k,-1], point = TRUE)
        plot(Dim.2 ~ Dim.1, subset(km.nbcl[[dig+1]]$pca, cluster == k),
             xlim = range(res2$Dim.1),
             ylim = range(res2$Dim.2),
             col = rainbow(km.nbcl[[dig+1]]$nc)[k], pch = 19, 
             axes = FALSE, xlab = &quot;&quot;, ylab = &quot;&quot;, frame.plot = TRUE)
    }
}</code></pre>
<p><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-1.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-2.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-3.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-4.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-5.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-6.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-7.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-8.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-9.png" width="672" /><img src="stat-prog-R-3-work_files/figure-html/unnamed-chunk-7-10.png" width="672" /></p>
</div>
</div>

</div>
<div class="footer">
      Site créé avec <a href="http://www.r-project.org" target="_blank"><code>R</code></a> et la 
      librairie  <a href="http://rmarkdown.rstudio.com/" target="_blank"><code>rmarkdown</code></a>.
</div>
<script>
    $("#TOC").css("margin-top", "100px");
</script>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
