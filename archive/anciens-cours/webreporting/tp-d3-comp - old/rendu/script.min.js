function creationPie(o,n){var c=d3.select("#pieChart");c.html("");var h=[],q=o.groupe.slice();$.unique(q.sort());q.forEach(function(u,t){var w,v,s=o.valeurs.filter(function(g,x){if(o.groupe[x]===u){return true}return false});switch(n){case"count":w=s.length;v=w;break;case"sum":w=d3.sum(s);v=Math.round(w/d3.sum(o.valeurs)*100)+" %";break;default:console.log("ERROR: 'type' doit être égal à 'count' ou 'sum'.");w=0}h.push({groupe:u,valeur:w,info:v})});var b=200,r=200,k=Math.min(b,r)/2;var d=d3.scale.ordinal().range(["#C3F800","#FF4F00"]).domain(q);var a=d3.svg.arc().outerRadius(k-10).innerRadius(0);var l=d3.svg.arc().outerRadius(k-40).innerRadius(k-40);var f=d3.layout.pie().sort(null).value(function(g){return g.valeur});var i=c.append("svg").attr("width",b).attr("height",r).append("g").attr("transform","translate("+b/2+","+r/2+")");var j=i.selectAll(".arc").data(f(h)).enter().append("g").attr("class","arc").on("click",function(g){creationTable(o,g.data.groupe);creationBarV(o,g.data.groupe)});j.append("path").attr("d",a).style("fill",function(g){return d(g.data.groupe)});j.append("text").attr("transform",function(g){return"translate("+l.centroid(g)+")"}).style("font-size","80%").text(function(g){return g.data.info});var e=15,m=4;var p=i.selectAll(".legend").data(d.domain()).enter().append("g").attr("class","legend").attr("transform",function(v,s){var t=e+m,u=-b/2,g=-r/2+s*t;return"translate("+u+","+g+")"});p.append("rect").attr("width",e).attr("height",e).style("fill",d).style("stroke",d);p.append("text").attr("x",e+m).attr("y",e-m).text(function(g){return g})}function creationTable(e,c){var a=$("#tab tbody"),b=$("<table>"),d=[];e.valeurs.forEach(function(f,g){switch(c){case"all":d.push([e.groupe[g],e.modalites[g],e.valeurs[g]]);break;default:if(c===e.groupe[g]){d.push([e.groupe[g],e.modalites[g],e.valeurs[g]])}}});a.html("");d.forEach(function(g){var f=$("<tr>");g.forEach(function(h){var i=$("<td>").html(h);f.append(i)});a.append(f)})}function creationBarH(b,a){}function creationBarV(l,e){var g,b=d3.select("#barV"),h=[];$("#barV").html("");l.valeurs.forEach(function(n,o){switch(e){case"all":h.push({groupe:l.groupe[o],modalite:l.modalites[o],valeur:l.valeurs[o]});break;default:if(e===l.groupe[o]){h.push({groupe:l.groupe[o],modalite:l.modalites[o],valeur:l.valeurs[o]})}}});switch(e){case"all":g="#CFCFCF";break;case"A":g="#C3F800";break;case"B":g="#FF4F00";break}var f={top:20,right:20,bottom:30,left:40},c=$("#barV").width()-f.left-f.right,m=300-f.top-f.bottom;var k=d3.scale.ordinal().rangeRoundBands([0,c],0.1);var j=d3.scale.linear().range([m,0]);var d=d3.svg.axis().scale(k).orient("bottom");var a=d3.svg.axis().scale(j).orient("left").ticks(10," ");var i=b.append("svg").attr("width",c+f.left+f.right).attr("height",m+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")");k.domain(h.map(function(n){return n.modalite}));j.domain([0,d3.max(h,function(n){return n.valeur})]);i.append("g").attr("class","x axis").attr("transform","translate(0,"+m+")").call(d);i.append("g").attr("class","y axis").call(a).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Occurences");i.selectAll(".bar").data(h).enter().append("rect").style("fill",g).attr("x",function(n){return k(n.modalite)}).attr("width",k.rangeBand()).attr("y",function(n){return j(n.valeur)}).attr("height",function(n){return m-j(n.valeur)})}function creationRendu(a){creationPie(a,"count");$("#repNombre").click(function(){creationPie(a,"count")});$("#repSomme").click(function(){creationPie(a,"sum")});creationTable(a,"all");creationBarV(a,"all")}function go(){d3.json("donnees.json",function(a){console.log(a.valeurs);console.log(a.modalites);console.log(a.groupe);creationRendu(a)})};